{% extends 'blog/base.html' %}
{% block content %}
  <div class="form-container admin-form">
    <h2 class="form-title">알림 등록 / 수정</h2>
    <p class="form-subtitle">
      긴급 공지나 수동으로 등록할 혼잡도 알림이 있을 때 사용합니다.
    </p>

    <form method="POST" enctype="multipart/form-data">
      {% csrf_token %}

      <p class="form-row">
        {{ form.author.label_tag }}
        {{ form.author }}
      </p>

      <p class="form-row">
        {{ form.title.label_tag }}
        {{ form.title }}
      </p>

      <p class="form-row">
        {{ form.text.label_tag }}
        {{ form.text }}
      </p>

      <div class="file-field">
        <label class="file-upload-label" for="id_image" style="background: #7084c8; color: #FFFFFF">이미지 선택</label>
        <span id="file-chosen">선택된 파일 없음</span>
        {{ form.image }}
      </div>

      <div class="button-group">
        <button type="submit" class="btn primary">저장</button>

        {% if post and post.pk %}
          <a href="{% url 'post_detail' pk=post.pk %}" class="btn btn-secondary" style="background:#b2aeca">취소</a>
        {% else %}
          <a href="{% url 'post_list' %}" class="btn btn-secondary" style="background:#b2aeca">취소</a>
        {% endif %}
      </div>
    </form>
  </div>

  <script>
    const fileInput = document.getElementById("id_image");
    const fileChosen = document.getElementById("file-chosen");
    const label = document.querySelector(".file-upload-label");

    if (fileInput && fileChosen && label) {
      label.addEventListener("click", () => fileInput.click());
      fileInput.addEventListener("change", () => {
        fileChosen.textContent = fileInput.files.length
          ? fileInput.files[0].name
          : "선택된 파일 없음";
      });
    }
  </script>
{% endblock %}
